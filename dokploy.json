{
  "version": "1.0",
  "name": "retailflux",
  "description": "Modern product scraping system for Supermarkets",
  
  "build": {
    "context": "./",
    "dockerfile": "infrastructure/docker-compose.prod.yml",
    "type": "docker-compose"
  },
  
  "environment": {
    "required_vars": [
      "POSTGRES_PASSWORD",
      "OPENAI_API_KEY",
      "SENTRY_DSN",
      "ALLOWED_HOSTS",
      "CORS_ORIGINS"
    ]
  },
  
  "services": {
    "postgres_db": {
      "image": "postgres_db_prod",
      "dockerfile": "./docker/postgres.prod.Dockerfile",
      "ports": ["5432:5432"],
      "volumes": [
        "postgres_data_prod:/var/lib/postgresql/data",
        "postgres_logs_prod:/var/log/postgresql",
        "./backups:/backups"
      ],
      "healthcheck": {
        "test": ["CMD-SHELL", "pg_isready -U $POSTGRES_USER -d $POSTGRES_DB"],
        "interval": "30s",
        "timeout": "10s",
        "retries": 5,
        "start_period": "40s"
      }
    },
    
    "api": {
      "image": "api_prod",
      "dockerfile": "./docker/api.prod.Dockerfile",
      "ports": ["8000:8000"],
      "depends_on": ["postgres_db"],
      "domain": {
        "enabled": true,
        "subdomain": "api.retailflux.de",
        "ssl": true
      },
      "healthcheck": {
        "test": ["CMD", "curl", "-f", "http://0.0.0.0:8000/health"],
        "interval": "30s",
        "timeout": "10s",
        "retries": 3
      }
    },
    
    "scraper": {
      "image": "scraper_prod",
      "dockerfile": "./docker/scraper.prod.Dockerfile",
      "depends_on": ["postgres_db"],
      "restart": "unless-stopped",
      "volumes": [
        "./data:/usr/src/app/data",
        "./logs:/usr/src/app/logs"
      ]
    }
  },
  
  "volumes": [
    "postgres_data_prod",
    "postgres_logs_prod"
  ],
  
  "deployment": {
    "strategy": "rolling",
    "max_replicas": 1,
    "health_check_grace_period": "60s"
  },
  
  "monitoring": {
    "enabled": true,
    "metrics": {
      "path": "/metrics",
      "port": 8000
    },
    "logs": {
      "driver": "json-file",
      "options": {
        "max-size": "10m",
        "max-file": "3"
      }
    }
  }
}